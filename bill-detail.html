<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Details - Hostel Bill Manager</title>
    
    <!-- Enhanced PWA Icons -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-128x128.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-96x96.png">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#6366F1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BillManager">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6366F1">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/calculator.css">
    <link rel="stylesheet" href="styles/dark-mode.css">
</head>
<body class="light-theme">
    <div class="container">
        <header class="page-header">
            <button class="back-btn" onclick="goBack()">‚Üê</button>
            <h1 id="billDetailTitle">Bill Details</h1>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span class="theme-icon">üåô</span>
            </button>
        </header>

        <div class="bill-info-bar">
            <span id="billDetailInfo"></span>
            <button class="btn-danger" onclick="deleteBill()">Delete Bill</button>
        </div>

        <div class="calculator-container view-mode">
            <div class="entries-log">
                <h3>Entries</h3>
                <div id="detailEntriesList"></div>
            </div>

            <div class="totals-section">
                <div class="final-totals" id="detailFinalTotals"></div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/theme.js"></script>
    <script>
        let currentBillId = null;

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            currentBillId = urlParams.get('id');
            
            if (currentBillId) {
                loadBillDetail(currentBillId);
            }
        });

        function loadBillDetail(billId) {
            const bills = getBills();
            const bill = bills.find(b => b.id === billId);
            
            if (bill) {
                document.getElementById('billDetailTitle').textContent = bill.name;
                document.getElementById('billDetailInfo').textContent = 
                    `Date: ${new Date(bill.date).toLocaleDateString()} ‚Ä¢ ${bill.category ? getCategoryIcon(bill.category) + ' ' + bill.category : ''}${bill.description ? ` ‚Ä¢ ${bill.description}` : ''}`;
                
                const entriesList = document.getElementById('detailEntriesList');
                entriesList.innerHTML = '';
                
                if (bill.entries.length === 0) {
                    entriesList.innerHTML = '<div class="empty-state">No entries in this bill</div>';
                } else {
                    bill.entries.forEach(entry => {
                        const names = entry.participants.split('').map(c => nameMap[c]?.name || c).join(', ');
                        const entryDiv = document.createElement('div');
                        entryDiv.className = 'entry-item view-entry';
                        entryDiv.innerHTML = `
                            <div>
                                <div><strong>‚Çπ${entry.price.toFixed(2)}</strong> - ${names}</div>
                                <div style="font-size: 14px; color: var(--text-secondary);">
                                    ${entry.description || ''}
                                </div>
                            </div>
                        `;
                        entriesList.appendChild(entryDiv);
                    });
                }

                if (bill.finalTotals) {
                    let html = '<h3>Final Bill:</h3>';
                    let totalSum = 0;
                    for(const [code,total] of Object.entries(bill.finalTotals)) {
                        html += `${nameMap[code]?.name || code}: ‚Çπ${total.toFixed(2)}<br>`;
                        totalSum += total;
                    }
                    html += `<hr><strong>Total Amount: ‚Çπ${totalSum.toFixed(2)}</strong><br>`;
                    html += `<strong>Total Amount pay to Shah jee: ‚Çπ${totalSum.toFixed(2)}</strong>`;
                    document.getElementById('detailFinalTotals').innerHTML = html;
                }
            }
        }

        function getCategoryIcon(category) {
            const icons = {
                'food': 'üçï',
                'groceries': 'üõí',
                'utilities': '‚ö°',
                'rent': 'üè†',
                'transport': 'üöó',
                'entertainment': 'üé¨',
                'other': 'üì¶'
            };
            return icons[category] || 'üìÅ';
        }

        function deleteBill() {
            if (confirm('Are you sure you want to delete this bill? This action cannot be undone.')) {
                const bills = getBills();
                const updatedBills = bills.filter(bill => bill.id !== currentBillId);
                localStorage.setItem('hostelBills', JSON.stringify(updatedBills));
                showNotification('Bill deleted successfully', 'success');
                setTimeout(() => navigateTo('previous-bills.html'), 1000);
            }
        }
    </script>
</body>
</html>
